name: "Label stale issues and PRs"
on:
  push:
    branches:
      - nate/stale-issue-helper
  schedule:
    - cron: "30 1 * * *"

jobs:
  stale:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        assignee: [sestinj, Patrick-Erichsen, tomasz-stefaniak, RomneyDa]
    steps:
      - uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version-file: .nvmrc

      - name: Compute excluded assignees
        id: excluded-assignees
        run: |
          result=$(node ./scripts/getExcludedAssignees.js sestinj,Patrick-Erichsen,tomasz-stefaniak,RomneyDa ${{ matrix.assignee }})

          echo "Result: $result"
          echo "excluded_assignees=$result" >> $GITHUB_OUTPUT

      - uses: actions/stale@v9
        with:
          stale-issue-message: "This issue hasn't been updated in a while. @${{ matrix.assignee }} can you take a look?"
          stale-pr-message: "This PR hasn't been updated in a while. @${{ matrix.assignee }} can you take a look?"
          days-before-stale: 180
          days-before-close: -1
          days-before-pr-close: -1
          stale-issue-label: "stale"
          stale-pr-label: "stale"
          debug-only: true
          exempt-issue-labels: "needs-triage,no-stale"
          exempt-pr-labels: "no-stale,no-stale"
          exempt-assignees: ${{ steps.excluded-assignees.outputs.excluded_assignees }}
          include-only-assigned: true
