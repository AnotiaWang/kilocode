name: Respond to @continuedev Comments

on:
  issue_comment:
    types: [created]

permissions:
  contents: read
  pull-requests: write
  issues: write

jobs:
  respond-to-comment:
    # Only run on pull request comments
    if: github.event.issue.pull_request
    runs-on: ubuntu-latest
    
    steps:
      - name: Check if comment contains @continuedev
        id: check-mention
        run: |
          if echo "${{ github.event.comment.body }}" | grep -q "@continuedev"; then
            echo "contains_mention=true" >> $GITHUB_OUTPUT
          else
            echo "contains_mention=false" >> $GITHUB_OUTPUT
          fi

      - name: Get comment content
        if: steps.check-mention.outputs.contains_mention == 'true'
        id: comment-content
        run: |
          # Store the comment body for debugging/logging
          echo "Comment mentioning @continuedev from ${{ github.event.comment.user.login }}:"
          echo "${{ github.event.comment.body }}"

      - name: Respond to @continuedev mention
        if: steps.check-mention.outputs.contains_mention == 'true'
        uses: actions/github-script@v7
        with:
          script: |
            const commentBody = `ðŸ‘‹ Thanks for mentioning @continuedev, @${{ github.event.comment.user.login }}! 

            I've received your comment:
            > ${{ github.event.comment.body }}

            Your input has been acknowledged and will be reviewed by the team.`;

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: commentBody
            });

      - name: Log acknowledgement
        if: steps.check-mention.outputs.contains_mention == 'true'
        run: |
          echo "âœ… Successfully acknowledged comment mentioning @continuedev from ${{ github.event.comment.user.login }} on PR #${{ github.event.issue.number }}"
          echo "Original comment: ${{ github.event.comment.body }}"